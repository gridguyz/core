(function(b,f,a){if(typeof a.store!=="undefined"){return}b.Zork.Store=function(){this.version="1.0";this.modulePrefix=["zork","store"]};b.Zork.prototype.store=new b.Zork.Store();var i,g="js-",k=function(){a.console.error("session not supported")},d=k,n=function(){a.console.error("cache not supported")},h=n,e=null;if(typeof b.sessionStorage!=="undefined"){k=function(o){return f.parseJSON(b.sessionStorage.getItem(g+o))};d=function(o,p){if(Object.isUndefined(p)){b.sessionStorage.removeItem(g+o)}else{b.sessionStorage.setItem(g+o,f.toJSON(p))}return p}}else{if(typeof b.globalStorage!=="undefined"){k=function(o){return f.parseJSON(b.globalStorage[b.location.hostname].getItem(g+"ses-"+o))};d=function(o,p){if(Object.isUndefined(p)){b.globalStorage[b.location.hostname].removeItem(g+"ses-"+o)}else{b.globalStorage[b.location.hostname].setItem(g+"ses-"+o,f.toJSON(p))}return p}}else{if(typeof b.document.createElement("input").addBehavior!=="undefined"){var l=f('<iframe id="html5Storage" src="/" style="display: none"></iframe>');f("body").append(l);i=l.contents()[0];i.close();var j=i.createElement('<input id="html5SessionStorage" type="hidden" />');j.addBehavior("#default#userData");i.body.appendChild(j);if(typeof j.save!=="undefined"&&typeof j.load!=="undefined"){var c=new Date();c.setDate(c.getDate()+1);j.expires=c.toUTCString();k=function(o){j.load(j.id);return f.parseJSON(j.getAttribute(g+o))};d=function(o,p){j.load(j.id);if(Object.isUndefined(p)){j.removeAttribute(g+o)}else{j.setAttribute(g+o,f.toJSON(p))}j.save(j.id);return p}}}else{if(typeof b.document.cookie!=="undefined"){k=function(r){var s=g+String(r).replace(/_61/g,"=").replace(/__/g,"_")+"=",p=b.document.cookie.split(";"),q,o=p.length;for(q=0;q<o;q++){var t=p[q];while(t.charAt(0)===" "){t=t.substring(1,t.length)}if(t.indexOf(s)===0){return f.parseJSON(t.substring(s.length,t.length).replace(/\\59/g,";").replace(/\\\\/g,"\\"))}}return null};d=function(q,r){var p=new Date();p.setTime(p.getTime()+((Object.isUndefined(r)?-1:1)*86400000));var o="; expires="+p.toGMTString();b.document.cookie=g+q.replace(/_/g,"__").replace(/=/g,"_61")+"="+(Object.isUndefined(r)?"":f.toJSON(r).replace(/\\/g,"\\\\").replace(/;/g,"\\59"))+o+"; path=/"}}}}}if(typeof b.localStorage!=="undefined"){n=function(p){var o=b.localStorage.getItem(g+p);if(Object.isUndefined(o)){return[]}o=o.split(";",3);if(parseInt(o[1],10)<Date.now()){b.localStorage.removeItem(g+p);return[]}else{o[0]=Date.now();b.localStorage.setItem(g+p,o.join(";"))}o[2]=f.parseJSON(o[2]);return o};h=function(s,t,o){if(Object.isUndefined(t)){b.localStorage.removeItem(g+s)}else{var q=b.localStorage.getItem(g+s),p=Date.now(),r=0;if(!Object.isUndefined(q)){q=q.split(";",3);r=q[0]}b.localStorage.setItem(g+s,r+";"+(p+o)+";"+f.toJSON(t))}return t};e=function(s){var q,o=b.localStorage.length;for(q=0;q<o;++q){var p=b.localStorage.key(),r=b.localStorage.getItem(p).split(";",3);if(p.indexOf(g)===0){s(p.substr(g.length),r[0],r[1])}}}}else{if(typeof b.globalStorage!=="undefined"){n=function(p){var o=b.globalStorage[b.location.hostname].getItem(g+p);if(Object.isUndefined(o)){return[]}o=o.split(";",3);if(parseInt(o[1],10)<Date.now()){b.globalStorage[b.location.hostname].removeItem(g+p);return[]}else{o[0]=Date.now();b.globalStorage[b.location.hostname].setItem(g+p,o.join(";"))}o[2]=f.parseJSON(o[2]);return o};h=function(s,t,o){if(Object.isUndefined(t)){b.globalStorage[b.location.hostname].removeItem(g+s)}else{var q=b.globalStorage[b.location.hostname].getItem(g+s),p=Date.now(),r=0;if(!Object.isUndefined(q)){q=q.split(";",3);r=q[0]}b.globalStorage[b.location.hostname].setItem(g+s,r+";"+(p+o)+";"+f.toJSON(t))}return t};e=function(s){var q,o=b.globalStorage[b.location.hostname].length;for(q=0;q<o;++q){var p=b.globalStorage[b.location.hostname].key(),r=b.globalStorage[b.location.hostname].getItem(p).split(";",3);if(p.indexOf(g)===0){s(p.substr(g.length),r[0],r[1])}}}}else{if(typeof b.document.createElement("input").addBehavior!=="undefined"){var m=i.createElement('<input id="html5LocalStorage" type="hidden" />');m.addBehavior("#default#userData");i.body.appendChild(m);if(typeof m.save!=="undefined"&&typeof m.load!=="undefined"){n=function(p){m.load(m.id);var o=m.getAttribute(g+p);if(Object.isUndefined(o)){return[]}o=o.split(";",3);if(parseInt(o[1],10)<Date.now()){m.removeAttribute(g+p);return[]}else{o[0]=Date.now();m.setAttribute(g+p,o.join(";"))}o[2]=f.parseJSON(o[2]);return o};h=function(v,u,q){m.load(m.id);var w=(m.getAttribute("keys")||"").split(";"),t=String(v).replace(/\\/g,"\\\\").replace(/;/g,"\\59"),s=w.indexOf(t);if(Object.isUndefined(u)){m.removeAttribute(g+v);if(s>=0){w.splice(s,1);m.setAttribute("keys",w.join(";"))}}else{var r=m.geAttribute(g+v),p=Date.now(),o=0;if(!Object.isUndefined(r)){r=r.split(";",3);o=r[0]}m.setAttribute(g+v,o+";"+(p+q)+";"+f.toJSON(u));if(s<0){w.push(t);m.setAttribute("keys",w.join(";"))}}m.save(m.id);return u};e=function(t){m.load(m.id);var r=(m.getAttribute("keys")||"").split(";"),q,o=r.length;for(q=0;q<o;++q){var p=r[q].replace(/\\59/g,";").replace(/\\\\/g,"\\"),s=m.getAttribute(g+p).split(";",3);t(p,s[0],s[1])}}}}}}b.Zork.Store.prototype.session=function(o,p){if(typeof p==="undefined"){return k(o)}return d(o,p)};b.Zork.Store.prototype.cache=function(w,v,p){if(e===null){a.console.error("cache not supported");return null}if(typeof v==="undefined"){var q=n(w);if(q.length>0){return q[2]}return null}p=p||this.cache.defaultTtl;h(w,v,p);if((v!==null)&&(n(w).length<1)&&p>0){var o=Date.now(),s=[];e(function(z,y,x){if(x<o){s.push(z)}});s.forEach(function(x){h(x,null)});h(w,v,p);var t,u=null,r=function(z,y,x){if((u===null)||(y<u)){u=y;t=z}};while(n(w).length<1){u=null;t=null;e(r);if(t===null){return null}h(t,null);h(w,v,p)}}return v};b.Zork.Store.prototype.cache.defaultTtl=86400000}(window,jQuery,zork));