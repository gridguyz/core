(function(d,i,c){if(typeof c.form!=="undefined"){return}d.Zork.Form=function(){this.version="1.0";this.modulePrefix=["zork","form"]};d.Zork.prototype.form=new d.Zork.Form();d.Zork.Form.Element=function(){this.version="1.0";this.modulePrefix=["zork","form","element"]};d.Zork.Form.prototype.element=new d.Zork.Form.Element();var o=function(t,s){if(typeof t==="undefined"||t===null||t===""){return true}var q=true,r=new RegExp("^"+t+"$");if(Array.isArray(s)){i.each(s,function(u,v){if(q&&!!r.test(v)){q=false}})}else{q=!!r.test(s)}return q},j=function(r,s){if(typeof r==="undefined"||r===null||r===""){return true}var q=true;if(Array.isArray(s)){i.each(s,function(t,u){if(q&&u<r){q=false}})}else{q=s>=r}return q},n=function(r,s){if(typeof r==="undefined"||r===null||r===""){return true}var q=true;if(Array.isArray(s)){i.each(s,function(t,u){if(q&&u>r){q=false}})}else{q=s<=r}return q},f=function(q,r){if(typeof q==="undefined"||q===null||q===""){return true}return r.length>=q},p=function(q,r){if(typeof q==="undefined"||q===null||q===""){return true}return r.length<=q},m=function(q,r){if(typeof q==="undefined"||q===null||q===""){return true}q=i.parseJSON(q);if(!Array.isArray(q)&&q.length===0){return true}return !i.inArray(r,q)},a=function(r,q){if(typeof q==="undefined"||q===null||q===""){return true}if(!(q in r[0].elements)){return false}return i(r[0].elements[q]).val()},k=function(s,r,t){var q=a(s,r);if(!Boolean.isBoolean(q)){q=q==t}return q},e=function(s,r,t){var q=a(s,r);if(!Boolean.isBoolean(q)){q=q!=t}return q},b=function(s,r,t){var q=a(s,r);if(!Boolean.isBoolean(q)){q=q<t}return q},g=function(s,r,t){var q=a(s,r);if(!Boolean.isBoolean(q)){q=q>t}return q},h=function(s,r,t){var q=a(s,r);return t||q},l=function(s,v,u){if(typeof v==="undefined"||v===null||v===""){return null}v=String(v).replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/);if(v.length===0){return null}var q=null,t=i(s).serializeArray(),r={};i.each(t,function(x,w){r[w.name]=w.value});i.each(v,function(w,y){if(q){return}var x=c.core.rpc(y)(u,r);if(x===true){}else{if(x===null){q="validate.rpc.returnNull"}else{if(x===false){q="validate.rpc.returnFalse"}else{if(String.isString(x)){if(x.length){q=x}}else{if(Array.isArray(x)){if(!(0 in x)){q="validate.rpc.returnEmpty"}if(x[0]===null||x[0]===false){if(1 in x){q=x[1]}else{if(x[0]===null){q="validate.rpc.returnNull"}else{if(x[0]===false){q="validate.rpc.returnFalse"}}}}}else{if(Object.isObject(x)){if(!("success" in x)){q="validate.rpc.returnEmpty"}if(x.success===null||x.success===false){if("message" in x){q=x.message}else{if(x.success===null){q="validate.rpc.returnNull"}else{if(x.success===false){q="validate.rpc.returnFalse"}}}}}else{q="validate.rpc.returnUnknown"}}}}}}});return q};d.Zork.Form.prototype.html5=function(r){r=i(r);r.find(":input[placeholder]:not([title])").each(function(){var t=i(this);t.attr("title",t.attr("placeholder"))});var q=false,s=function(t){if(q||r.attr("novalidate")){return true}var u=true;r.find(":input:not(:disabled)").each(function(){var H=i(this),G=false,x=!!H.attr("multiple"),D=H.attr("type")||String(H[0].tagName).toLowerCase(),w=H.val(),F=typeof this.checkValidity!=="undefined",B=typeof this.setCustomValidity!=="undefined",C=F?this.checkValidity():true,v={};if(H.is("textarea:data(jsCodeeditorWidget)")){var E=H.data("jsCodeeditorWidget");w=E&&E.getDoc()?E.getDoc().getValue():w;if(w){H.val(w)}}else{if(D==="checkbox"){w=this.checked?H.attr("value"):null}else{if(D==="radio"){w=r.find(':input[name="'+H.attr("name")+'"]:checked').map(function(){return i(this).attr("value")}).get()}else{if(D==="email"&&x){w=w.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s*,\s*/)}}}}if(D==="password"){var z=new Array(String(w).length+1);v.value=z.join("*")}else{v.value=String(w)}if(F&&!C){if(D==="datetime"){H.val(w.replace(/([ T][0-9]{2}:[0-9]{2}):[0-9]{2}(Z|[+-]\d{2}:?\d{2})$/,"$1:00$2"));C=this.checkValidity()}else{if(D==="datetime-local"){H.val(w.replace(/([ T][0-9]{2}:[0-9]{2}):[0-9]{2}$/,"$1:00"));C=this.checkValidity()}}}if(!F||(!C&&D==="radio")){C=true;G="";if(H.attr("required")&&(w===null||w.length===0)){C=false;G="validate.required"}else{if(!o(H.attr("pattern"),w)){C=false;G="validate.regex";v.pattern=H.attr("title")||H.attr("pattern")}else{if(!j(H.attr("min"),w)){C=false;G="validate.between.min";v.min=H.attr("min")}else{if(!n(H.attr("max"),w)){C=false;G="validate.between.max";v.max=H.attr("max")}else{if(!p(H.attr("maxlength"),w)){C=false;G="validate.length.higher";v.max=H.attr("maxlength");v.length=w.length}else{switch(D){case"color":if(!/^#[a-fA-F0-9]{6}$/.test(w)){C=false;G="validate.color"}break;case"date":if(!/^\d{4,}-\d{2}-\d{2}$/.test(w)){C=false;G="validate.date"}break;case"datetime":if(!/^\d{4,}-\d{2}-\d{2}[ T]\d{2}:\d{2}:\d{2}(:\d{2}(\.\d+))?(Z|[+-]\d{2}:?\d{2})$/.test(w)){C=false;G="validate.datetime"}break;case"datetime-local":if(!/^\d{4,}-\d{2}-\d{2}[ T]\d{2}:\d{2}:\d{2}(:\d{2}(\.\d+))?$/.test(w)){C=false;G="validate.datetime-local"}break;case"email":if(!/^[a-zA-Z0-9.!#$%&\'*+\/=?^_`{|}~-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*$/.test(w)){C=false;G="validate.email"}break;case"month":if(!/^\d{4,}-\d{2}$/.test(w)){C=false;G="validate.month"}break;case"number":case"range":if(!/^([1-9][0-9]*|0)(\.[0-9]+)?$/.test(w)){C=false;G="validate.number"}break;case"time":if(!/^\d{2}:\d{2}(:\d{2}(\.\d+))?$/.test(w)){C=false;G="validate.month"}break;case"url":if(!/^(https?|s?ftp):\/\/[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)(\/.*)?$/.test(w)){C=false;G="validate.url"}break;case"week":if(!/^\d{4,}-W\d{2}?$/.test(w)){C=false;G="validate.week"}break}}}}}}}if(!G&&C){if(!f(H.attr("data-validate-minlength"),w)){C=false;G="validate.length.lower";v.min=H.attr("data-validate-minlength");v.length=w.length}else{if(!m(H.attr("data-validate-forbidden"),w)){C=false;G="validate.forbidden.forbidden"}else{if(!k(r,H.attr("data-validate-identical"),w)){C=false;G="validate.identical.notMatch"}else{if(!e(r,H.attr("data-validate-not-identical"),w)){C=false;G="validate.notIdentical.match"}else{if(!h(r,H.attr("data-validate-alternate"),w)){C=false;G="validate.alternate.noneGiven"}else{if(!b(r,H.attr("data-validate-less-than"),w)){C=false;G="validate.lessThan.notLess"}else{if(!g(r,H.attr("data-validate-more-than"),w)){C=false;G="validate.moreThan.notMore"}else{G=l(r,H.attr("data-validate-rpcs"),w);if(G&&G.length){C=false}}}}}}}}}if(C){H.removeClass("invalid");if(F){if(B){try{this.setCustomValidity("")}catch(A){}}else{H.tooltip({items:"*",content:""})}}}else{H.addClass("invalid");if(G){G=c.core.translate(G);for(var y in v){G=G.replace(new RegExp("%"+RegExp.escape(y)+"%","g"),v[y])}if(F&&B){try{this.setCustomValidity(G)}catch(A){}H.one("change keyup",function(){try{this.setCustomValidity("")}catch(I){}})}else{H.tooltip({items:"*",content:G});H.one("change keyup",function(){H.tooltip({items:"*",content:""})})}}}u=u&&C});if(!u){if(!("checkValidity" in r[0])){i(":input.invalid:first").focus();t.preventDefault()}}};r.find(":input").each(function(t,u){c.form.element.html5(this)});r.on("submit",s).on("click",":submit[formnovalidate]",function(){q=true;if(c.core.browser.chrome&&c.core.browser.chrome>=30&&c.core.browser.chrome<=31&&i(this).is("input")){r.attr("novalidate","novalidate").prop("noValidate",true)}}).on("click",":submit:not([formnovalidate])",function(t){q=false;return s.call(this,t)}).on("click",":submit[formaction]",function(){if(!("formAction" in this)){r.attr("action",i(this).attr("formaction"))}}).on("click",":submit[formenctype]",function(){if(!("formEnctype" in this)){r.attr("enctype",i(this).attr("formenctype"))}}).on("click",":submit[formmethod]",function(){if(!("formMethod" in this)){r.attr("method",i(this).attr("formmethod"))}}).on("click",":submit[formtarget]",function(){if(!("formTarget" in this)){r.attr("target",i(this).attr("formtarget"))}})};d.Zork.Form.Element.prototype.html5=function(s){s=i(s);if(s.data("jsForm")==="basic"){return}var q=String(s[0].tagName).toLowerCase(),v=String(s.attr("type")||q),t=String(s.prop("type")||q);if(v===t){switch(v){case"checkbox":case"radio":var u=function(){var B=i(s[0].form||s.closest("form")),z=s.is("[required], [data-validate-required=true]"),A=s.prop("checked"),y=s.prop("name"),C='input[type="'+v+'"][name="'+String(y).replace(/"/g,'\\"')+'"]';if(y&&z){if(A){B.find(C+"[required]").removeAttr("required").data("validateRequired",true).attr("data-validate-required","true")}else{if(!B.find(C+":checked").length){B.find(C+"[data-validate-required=true]").attr("required","required").data("validateRequired",false).removeAttr("data-validate-required")}}}};s.on("click change",u);if(s.prop("checked")){u()}break;case"color":var x=s[0].getAttribute("value"),r=String(s.attr("name")||""),w=i('<input type="text">').val(x);s.prop("disabled",!x);w.change(function(){var y=w.val();s.val(y).prop("disabled",!y).trigger("change")});s.parent().on("mouseenter mouseover mousemove",function(){s.prop("disabled",false)}).on("mouseleave mouseout",function(){s.prop("disabled",!w.val())});s.on("click input change",function(){w.val(s.prop("disabled")?"":s.val())});s.before(w).css({width:s.height(),"min-width":"1em"});if(r&&!/\[\]$/.test(r)){s.before(i('<input type="hidden">').attr({name:r,value:""}))}break}}else{switch(v){case"color":if(!s.is('[data-js-type~="js.form.element.color"]')){c.require("js.form.element.color")(s)}break;case"date":if(!s.is('[data-js-type~="js.form.element.date"]')){c.require("js.form.element.date")(s)}break;case"datetime":case"datetime-local":if(!s.is('[data-js-type~="js.form.element.dateTime"]')){c.require("js.form.element.dateTime")(s)}break;case"number":if(!s.is('[data-js-type~="js.form.element.number"]')){c.require("js.form.element.number")(s)}break;case"range":if(!s.is('[data-js-type~="js.form.element.range"]')){c.require("js.form.element.range")(s)}break;case"time":if(!s.is('[data-js-type~="js.form.element.time"]')){c.require("js.form.element.time")(s)}break}}};d.Zork.Form.prototype.validator=function(r){r=i(r);var q=false,s=function(){if(q||r.attr("novalidate")){return true}var t=true;r.find("[data-js-validators]:input:not(:disabled)").each(function(){t=c.validate.validate(this)&&t});if(!t){i("[data-js-validators].ui-state-error:first").focus()}return t};c.require("js.validate",function(){r.submit(s);r.find(":submit[formnovalidate]").live("click",function(){q=true});r.find(":submit:not([formnovalidate])").live("click",function(){q=false;return s.call(this)})});i(":submit",r).parent().inputset()};d.Zork.Form.prototype.validator.isElementConstructor=true;d.Zork.Form.prototype.cancel=function(w,v){w=i(w);var u=w.find("button:submit"),q=w.find("input:submit"),t,r,s;v=v||Object(w.data("jsCancelButtons"));for(s in v){(function(y,x){var z=null;if(typeof x==="function"){z=x}else{z=function(){d.location.href=x}}t=i("<button type='button' />").html(y);r=i("<input type='button' />").val(y);i([t[0],r[0]]).addClass("ui-button-cancel").click(z);u.after(t);q.after(r)}(c.core.translate(s,w.attr("lang")||w.attr("xml:lang")||null),v[s]))}i(":submit",w).parent().inputset()};d.Zork.Form.prototype.cancel.isElementConstructor=true;d.Zork.Form.prototype.buttonset=function(q){q=i(q);q.buttonset()};d.Zork.Form.prototype.buttonset.isElementConstructor=true;d.Zork.Form.prototype.inputset=function(q){q=i(q);q.inputset()};d.Zork.Form.prototype.inputset.isElementConstructor=true;d.Zork.Form.prototype.submit=function(r){r=i(r);var s=i(r[0].form||r.closest("form")),q=r.data("jsFormSubmitOn")||"change";r.on(q,function(){s.submit()})};d.Zork.Form.prototype.submit.isElementConstructor=true}(window,jQuery,zork));